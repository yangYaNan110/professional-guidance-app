#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
文档处理服务
生成专业介绍、行业分析等内容
支持基于学科热度的缓存策略
"""

import json
import os
from typing import Dict, Any, List, Optional
from datetime import datetime, timedelta
from dataclasses import dataclass, field
import hashlib


# 热门学科列表（这些学科更新频繁，需要更短的缓存时间）
HOT_MAJORS = {
    # AI相关
    "人工智能", "机器学习", "深度学习", "自然语言处理", "计算机视觉",
    # 新兴技术
    "数据科学与大数据技术", "云计算", "物联网", "区块链", "网络安全",
    # 热门工程
    "计算机科学与技术", "软件工程", "电子信息工程", "自动化",
    # 热门经济管理
    "金融学", "经济学", "工商管理", "数据管理",
    # 热门医学
    "临床医学", "口腔医学",
    # 热门法学
    "法学"
}

# 缓存过期时间配置（秒）
CACHE_EXPIRY_CONFIG = {
    "hot": 24 * 60 * 60,      # 热门学科：1天
    "normal": 3 * 24 * 60 * 60  # 冷门专业：3天
}


@dataclass
class MajorIntroduction:
    """专业介绍"""
    name: str
    category: str
    origin: str
    development: str
    current_status: str
    trends: str
    core_courses: List[str] = field(default_factory=list)
    career_prospects: str = ""
    related_majors: List[str] = field(default_factory=list)
    generated_at: str = field(default_factory=lambda: datetime.now().isoformat())
    cached: bool = False
    cache_expires_at: Optional[str] = None


class DocumentProcessor:
    """文档处理器"""
    
    # 专业介绍模板 - 按时间线叙述
    MAJOR_CATEGORIES = {
        "工学": {
            "timeline": """**起源与发展**  
{major}的发展历程与人类工业革命紧密相连。18世纪60年代，英国率先完成第一次工业革命，蒸汽机的发明标志着机器生产时代的到来。随后，19世纪70年代的第二次工业革命带来了电力广泛应用，20世纪40年代的第三次工业革命则以电子计算机、原子能、航天技术为标志。

**挫折与争议**  
在发展过程中，{major}经历了多次低谷。早期工业化带来的环境污染问题曾引发社会担忧，20世纪70年代的石油危机也对传统制造业造成冲击。此外，技术迭代快、人才培养周期长等问题也是该领域面临的挑战。

**重大突破**  
进入21世纪，物联网、人工智能、大数据等新技术的融合应用，为{major}带来了革命性变化。2010年后，智能制造、工业4.0概念的提出，使{major}进入新一轮快速发展期。中国"中国制造2025"战略的提出，进一步推动了该领域的蓬勃发展。

**现状与爆发**  
当前，{major}已成为国家战略性新兴产业的重要组成部分。在新能源汽车、工业机器人、高端装备制造等领域，中国已跻身世界前列。涌现出华为、比亚迪、大疆等一批具有国际竞争力的企业。产业规模持续扩大，2023年中国{major}产值已突破30万亿元。

**未来展望**  
展望未来，智能制造、绿色制造、服务型制造将成为{major}发展的三大方向。到2035年，中国{major}有望达到世界先进水平。该领域对复合型人才需求旺盛，特别是掌握人工智能、大数据分析等新技术的工程师，薪资水平普遍高于其他行业。""",
            "core_courses": ["高等数学", "线性代数", "概率论与数理统计", "大学物理", "工程制图", "专业核心课程"],
            "related_majors": ["机械工程", "电子信息工程", "计算机科学与技术", "自动化"]
        },
        "理学": {
            "timeline": """**起源与发展**  
{major}是人类认识自然、探索规律的基础学科。其源头可追溯至古希腊时期，亚里士多德对自然现象的系统研究奠定了学科基础。文艺复兴时期，伽利略、牛顿等科学家将实验方法引入研究，推动{major}进入快速发展期。17世纪牛顿发表《自然哲学的数学原理》，标志着现代{major}的诞生。

**挫折与争议**  
{major}的发展并非一帆风顺。19世纪末20世纪初，经典物理学面临"两朵乌云"（黑体辐射危机和迈克尔逊-莫雷实验），引发物理学革命。此外，学科发展与宗教、哲学的冲突也时有发生。基础研究周期长、见效慢的特点，使其长期面临经费不足、人才流失等问题。

**重大突破**  
20世纪初，相对论和量子力学的建立是{major}史上最伟大的革命。1905年爱因斯坦提出狭义相对论，1915年广义相对论问世；1925年海森堡提出矩阵力学，1926年薛定谔建立波动力学。这些突破彻底改变了人类对物质世界的认知。

**现状与爆发**  
进入21世纪，{major}在量子信息、拓扑材料、引力波探测等领域取得重大突破。2015年LIGO首次探测到引力波；2016年中国发射"墨子号"量子卫星；2022年诺贝尔物理学奖授予量子纠缠研究。这些成就标志着{major}进入新一轮爆发期。中国在量子通信、超导研究等领域处于国际领先地位。

**未来展望**  
量子科技、粒子物理、宇宙探索将是{major}未来发展的重要方向。国家对基础研究投入持续加大，"十四五"期间{major}研发经费年均增长10%以上。该领域需要大量具有扎实理论基础和创新能力的科研人才，虽然道路漫长，但为人类认识宇宙作出贡献的使命感吸引着无数学子投身其中。""",
            "core_courses": ["高等数学", "线性代数", "概率论与数理统计", "大学物理", "专业基础课"],
            "related_majors": ["数学", "物理学", "化学", "天文学"]
        },
        "医学": {
            "timeline": """**起源与发展**  
{major}的历史可追溯至人类文明的早期。古埃及的 Edwin Smith 外科手稿（约公元前1600年）是现存最早的医学文献；古希腊的希波克拉底（约公元前460-370年）被尊为"医学之父"，他提出的职业道德规范至今仍是医学伦理的基础；古罗马的盖伦（129-216年）建立了系统的解剖学和生理学体系。

**挫折与争议**  
医学发展历程中充满挫折与争议。中世纪的欧洲，医学发展受宗教桎梏，解剖学研究被禁止。19世纪中期，产褥热曾夺去大量产妇生命，直到塞麦尔维斯发现洗手可以预防感染。20世纪初，放射性物质和抗生素的滥用也造成过严重后果。这些教训推动了医学伦理和规范的发展。

**重大突破**  
20世纪是{major}的黄金时代。1928年弗莱明发现青霉素，1945年开始大规模临床使用，拯救了无数生命。1953年沃森和克里克发现DNA双螺旋结构，分子生物学时代开启。1978年世界卫生组织宣布天花被彻底消灭，这是人类对抗传染病的里程碑。2003年人类基因组计划完成，为精准医学奠定基础。

**现状与爆发**  
当前，{major}正经历前所未有的革命性变化。免疫疗法让部分癌症患者获得长期生存；基因编辑技术CRISPR为遗传病治疗带来希望；人工智能辅助诊断准确率已超过资深专家；mRNA技术在新冠疫苗研发中大放异彩。中国在CAR-T细胞治疗、PD-1/PD-L1免疫检查点抑制剂等领域取得突破性进展。

**未来展望**  
精准医疗、再生医学、脑机接口、抗衰老研究将是{major}未来最有前景的方向。预计到2030年，中国健康产业规模将突破16万亿元。该领域对人才需求巨大，特别是跨学科复合型人才（如医学+AI、医学+大数据），既有崇高社会价值，职业前景也非常广阔。""",
            "core_courses": ["人体解剖学", "生理学", "生物化学", "病理学", "药理学", "诊断学", "内科学", "外科学"],
            "related_majors": ["临床医学", "口腔医学", "护理学", "公共卫生与预防医学"]
        },
        "法学": {
            "timeline": """**起源与发展**  
{major}的源头可追溯至古罗马。公元前450年，罗马颁布《十二铜表法》，这是古代世界第一部成文法典。欧洲中世纪，注释法学派和评论法学派系统整理了罗马法，为现代法学奠定基础。1804年《法国民法典》（拿破仑法典）颁布，成为近代民法的典范，影响深远。

**挫折与争议**  
法学发展历程中也经历过黑暗时期。封建社会时期，法律服务于特权阶级，司法不公现象普遍。20世纪的两次世界大战，纳粹德国的种族灭绝法律、日本的侵略战争，都暴露了法学被滥用的危害。二战后，国际社会痛定思痛，推动了国际人权法的发展。

**重大突破**  
二战后，{major}迎来重大变革。1948年《世界人权宣言》发表，确立了人权保障的普世价值。1998年国际刑事法院成立，追究反人类罪行。中国改革开放后，法学建设进入快车道。1982年现行宪法颁布，2014年十八届四中全会专题研究依法治国，2020年《民法典》颁布实施，标志着中国特色法学体系日趋完善。

**现状与爆发**  
当前，全面依法治国是国家战略，{major}迎来前所未有的发展机遇。法治政府建设深入推进，企业合规管理成为新热点，数据法、知识产权法、环境法等新兴领域快速发展。涉外法治人才缺口巨大，"一带一路"建设需要大量熟悉国际规则的法律人才。中国法学研究正在从"引进来"向"走出去"转变。

**未来展望**  
数字法学、金融法、涉外法治、海洋法等方向将是{major}发展的新蓝海。随着中国深度参与全球治理，对高端涉外法治人才需求迫切。该专业需要通过法律职业资格考试，起步期竞争激烈，但职业发展空间大，社会地位高，是维护社会公平正义的重要力量。""",
            "core_courses": ["法理学", "宪法学", "民法学", "刑法学", "行政法学", "国际法学", "经济法学"],
            "related_majors": ["法学", "社会学", "政治学与行政学", "知识产权"]
        },
        "社会学": {
            "timeline": """**起源与发展**  
{major}作为一门独立学科，诞生于19世纪中叶的欧洲。法国哲学家孔德（1798-1857）在1838年首次提出"社会学"一词，被尊为"社会学之父"。英国社会学家斯宾塞发展了社会进化论，爱米尔·涂尔干建立了实证主义社会学方法论。马克思从唯物史观角度分析社会结构。19世纪末20世纪初，社会学传入中国。

**挫折与争议**  
{major}发展历程中经历过低谷。20世纪初，学科性质和研究方法曾引发"社会学危机"大讨论。冷战时期，意识形态对立影响了学术交流。学科定位模糊、与哲学和历史学边界不清的问题长期存在。1970年代西方社会学曾陷入理论停滞期。

**重大突破**  
二战后，{major}迎来理论繁荣期。结构功能主义、符号互动论、现象学社会学等流派涌现。1970年代，布迪厄提出"文化资本"概念，推动了文化社会学发展。1990年代以来，全球化、信息化催生了网络社会学、数字社会学等新方向。中国社会学在改革开放后重建，逐步形成本土化特色。

**现状与爆发**  
当前，{major}在中国发展势头强劲。社会治理现代化为{major}提供了广阔舞台。社会调查、大数据分析、政策评估成为重要研究方法。涌现出费孝通"差序格局"、陆学艺社会分层研究等重要成果。社会工作、社区治理等专业方向快速发展。

**未来展望**  
数字社会学、人口老龄化、乡村振兴、基层治理将是{major}最有前景的方向。国家社会治理能力现代化建设需要大量专业人才。该领域就业面广，可在政府部门、研究机构、社会组织、企业HR等部门工作。选择{major}，就是选择参与中国式现代化的伟大实践。""",
            "core_courses": ["社会学概论", "社会研究方法", "社会心理学", "西方社会学理论", "中国社会思想", "社会统计学", "社区概论"],
            "related_majors": ["社会工作", "政治学与行政学", "法学", "心理学"]
        },
        "经济学": {
            "timeline": """**起源与发展**  
{major}作为一门独立学科，始于1776年亚当·斯密《国富论》的发表。这部著作系统阐述了市场经济的运作原理，"看不见的手"成为经济学的基础概念。19世纪末，马克思《资本论》对资本主义进行了深刻剖析；边际革命后，经济学开始走向数学化和精密化。

**挫折与争议**  
20世纪30年代的大萧条是经济学的重大挫折。传统经济学无法解释经济危机的原因，凯恩斯革命应运而生。2008年全球金融危机再次暴露了主流经济学的局限性，对金融监管的反思催生了行为经济学、实验经济学等新学派。经济学模型的假设与现实脱节也常受批评。

**重大突破**  
20世纪是{major}理论突破的黄金期。1936年凯恩斯发表《就业、利息和货币通论》，开创了宏观经济学的现代范式。1950年代，萨缪尔森将数学方法系统引入经济学，促成新古典综合学派的形成。1990年代以来，博弈论、信息经济学、行为经济学的发展，极大丰富了经济学的分析工具。

**现状与爆发**  
当前，{major}正经历数字化转型。大数据、机器学习被应用于经济预测和政策分析；数字经济成为全球增长的新引擎。中国数字经济规模已突破50万亿元，占GDP比重超过40%。FinTech（金融科技）正在重塑传统金融业态，移动支付、数字货币、智能投顾等新业态层出不穷。

**未来展望**  
数字经济、绿色金融、发展经济学将是{major}最有前景的方向。中国经济从高速增长转向高质量发展，需要大量经济学专业人才。该领域就业面广，可在政府部门、金融机构、企业研究部门等工作，薪资水平与社会影响力俱佳。""",
            "core_courses": ["微观经济学", "宏观经济学", "计量经济学", "货币银行学", "财政学", "国际经济学", "发展经济学"],
            "related_majors": ["金融学", "经济学", "工商管理", "统计学"]
        },
        "文学": {
            "timeline": """**起源与发展**  
{major}是研究语言文字及其应用的学科，其历史与人类文明同样悠久。中国的《诗经》是最早的诗歌总集之一，承载着先民的生活与情感。古希腊的《荷马史诗》、莎士比亚的戏剧，都是{major}发展史上的里程碑。印刷术的发明大大促进了文学的传播。

**挫折与争议**  
{major}的发展并非一帆风顺。焚书坑儒、文字狱等历史事件对文学创作造成严重打击。近代以来，白话文与文言文之争、新文化运动，都引发了对{major}发展方向的热烈讨论。商业化、网络化时代，文学的雅俗之争、快餐文化与经典文学的冲突也持续存在。

**重大突破**  
20世纪是{major}变革的关键时期。新文化运动推动白话文成为主流，鲁迅、胡适等大师开创了中国现代文学的新纪元。1980年代"伤痕文学"、"寻根文学"反映了时代反思。1990年代市场化改革后，文学走向多元化，网络文学、类型文学兴起。2010年后，IP改编、跨媒介叙事成为新趋势。

**现状与爆发**  
当前，{major}正经历前所未有的变革。新媒体时代，内容创作呈现井喷态势。网络文学用户规模超过5亿，付费阅读模式日趋成熟。短视频、播客等新形式为{major}注入了新活力。科幻文学《三体》获得雨果奖，标志着中国文学走向世界。文化产业GDP占比持续提升，内容创作人才需求旺盛。

**未来展望**  
数字内容创作、跨媒介叙事、文化出海将是{major}发展的新方向。中国文化软实力提升需要大量创作人才，既懂传统文化又掌握现代传播技巧的复合型人才最为稀缺。该领域就业灵活，可从事写作、编辑、编剧、策划、新媒体运营等工作，虽然竞争激烈，但优秀创作者的社会影响力和经济回报都非常可观。""",
            "core_courses": ["现代汉语", "古代汉语", "文学概论", "写作", "外国文学", "中国文学史", "文艺理论"],
            "related_majors": ["汉语言文学", "新闻学", "传播学", "戏剧影视文学"]
        },
        "教育学": {
            "timeline": """**起源与发展**  
{major}的历史可追溯至春秋时期，孔子开创了私学传统，《学记》是世界上最早的教育学专著。西方教育学的科学化始于17世纪，捷克教育家夸美纽斯提出班级授课制；18世纪卢梭《爱弥儿》倡导自然教育；19世纪赫尔巴特建立教育学体系，被尊为"教育科学之父"。

**挫折与争议**  
{major}发展历程中充满曲折。应试教育弊端长期受人诟病，"唯分数论"导致学生创新能力不足。教育公平问题突出，城乡、区域差距悬殊。填鸭式教学、题海战术等传统模式与素质教育理念冲突。技术赋能教育的边界（如在线教育是否削弱师生互动）也引发广泛讨论。

**重大突破**  
20世纪是{major}理论创新的黄金期。杜威"做中学"理念影响深远；布鲁姆目标分类学成为课程设计的基础框架；加德纳多元智能理论挑战了传统智商观念。中国教育学从引进西方理论到本土化创新，形成了自己的特色。改革开放后，高考制度恢复、义务教育普及、高等教育大众化是中国教育史上的里程碑。

**现状与爆发**  
当前，{major}正经历数字化革命。在线教育市场规模突破万亿，疫情期间在线学习成为常态。人工智能技术使得个性化学习成为可能，自适应学习系统能根据学生特点调整教学内容和节奏。教育+AI、大数据驱动的精准教学、虚拟现实沉浸式学习等新模式不断涌现。中国在线教育用户规模全球第一。

**未来展望**  
智慧教育、终身学习、教育公平将是{major}发展的三大主题。国家"十四五"规划强调建设高质量教育体系，到2035年建成教育强国。该领域对人才需求稳定，教师职业稳定且有寒暑假，课程设计、教育技术等新兴方向增长迅速。教育是百年大计，为人师表具有崇高社会价值。""",
            "core_courses": ["教育学原理", "教育心理学", "课程与教学论", "教育研究方法", "教育史", "德育原理"],
            "related_majors": ["教育学", "学前教育", "特殊教育", "教育技术学"]
        },
        "农学": {
            "timeline": """**起源与发展**  
{major}是人类文明的基础。中国农业历史可追溯至距今约9000年前，稻作农业起源于长江流域。古埃及、古巴比伦、古罗马等文明都发展出了先进的灌溉农业。19世纪末20世纪初，现代农学作为一门独立学科诞生，遗传学之父孟德尔的研究奠定了学科基础。

**挫折与争议**  
{major}发展历程中面临诸多挑战。传统农业效率低下，难以满足快速增长的人口需求。化肥农药的过度使用造成土壤退化和环境污染。农业面源污染、农产品安全问题是社会关注焦点。此外，城乡差距导致农村人才流失，"谁来种地"成为时代之问。

**重大突破**  
20世纪是{major}技术革命的黄金期。绿色革命是其中最伟大的成就。1960年代，矮秆小麦、水稻品种的培育成功，使粮食产量大幅增长，拯救了数亿人免于饥饿。中国杂交水稻研究处于世界领先地位，袁隆平院士被誉为"杂交水稻之父"。生物技术、转基因技术的应用进一步提升了农业生产效率。

**现状与爆发**  
当前，{major}正经历智慧化转型。物联网、大数据、人工智能等技术正在改变农业生产方式。智慧温室、无人机植保、智能养殖等新模式推广应用。中国农业科技进步贡献率已超过60%。数字乡村建设推动农业现代化加速，农产品电商、农村物流网络日益完善。

**未来展望**  
智慧农业、种业振兴、绿色农业将是{major}发展的三大方向。乡村振兴战略为农学人才提供了广阔舞台。到2035年，中国将基本实现农业农村现代化。该领域对人才需求持续增长，特别是在智慧农业、农产品加工、农业物联网等新兴领域，既有服务国家战略的使命担当，也有良好的职业发展前景。""",
            "core_courses": ["植物学", "动物学", "遗传学", "生物化学", "农学概论", "作物栽培学", "土壤学"],
            "related_majors": ["农学", "动物医学", "园艺学", "食品科学与工程"]
        },
        "历史学": {
            "timeline": """**起源与发展**  
{major}是人类对过去的系统研究。中国史学传统源远流长，春秋时期孔子编订《春秋》，西汉司马迁著《史记》，开创了纪传体史书的先河。西方史学起源于古希腊，希罗多德被尊为"史学之父"，修昔底德的《伯罗奔尼撒战争史》奠定了政治军事史的传统。

**挫折与争议**  
{major}的发展并非一帆风顺。中世纪欧洲，教会控制史学，神学史观占主导地位。近代以来，史学受民族主义、意识形态影响，客观性常受质疑。历史虚无主义、史料造假等问题时有发生。如何在"求真"与"致用"之间取得平衡，是史学家长期思考的问题。

**重大突破**  
19世纪是{major}科学化的关键时期。德国史学家兰克提出"如实再现历史"的理念，强调原始档案的运用。20世纪，年鉴学派兴起，关注"长时段"历史和整体史。计量史学的引入使历史研究更加精确。近年来，数字人文、大数据为史学研究提供了新工具。

**现状与爆发**  
当前，{major}呈现多元化发展态势。全球史、环境史、社会史、性别史等新分支不断涌现。中国史研究在史料整理、专题研究等方面取得丰硕成果。考古新发现（如海昏侯墓、三星堆）持续刷新认知。历史纪录片、历史科普类节目走红，反映公众对历史的浓厚兴趣。

**未来展望**  
数字人文、公众史学、国际史学交流将是{major}发展的新方向。中国历史研究院的成立标志着史学研究进入新阶段。国家对历史研究投入持续加大，文化遗产保护、文博事业发展需要大量专业人才。该领域虽然就业面相对较窄，但职业稳定，能满足对历史有浓厚兴趣的学子的求知欲和使命感。""",
            "core_courses": ["中国史", "世界史", "史学概论", "历史文献学", "考古学概论", "中国历史文选"],
            "related_majors": ["历史学", "考古学", "博物馆学", "世界史"]
        },
        "管理学": {
            "timeline": """**起源与发展**  
{major}的源头可追溯至19世纪末20世纪初的工业革命时期。1881年，美国沃顿商学院成立，标志着商科教育的开端。1911年，泰勒的《科学管理原理》出版，开创了管理学的科学时代。1920年代，亨利·法约尔的一般管理理论丰富了管理学体系。1940年代，行为科学学派兴起。

**挫折与争议**  
{major}发展历程中经历过多次反思。1960-1970年代，传统管理理论面临环境变化的挑战。日本企业的崛起（如丰田生产方式）对美国管理学形成冲击。2001年安然事件、2008年金融危机暴露了企业管理的失败，引发对商科教育的反思。管理理论的普遍性与本土化之争持续存在。

**重大突破**  
20世纪是{major}理论创新的黄金期。1960年代，战略管理理论兴起，安索夫《公司战略》奠定基础。1980年代，迈克尔·波特竞争战略理论风靡全球。1990年代，彼得·圣吉《第五项修炼》推动学习型组织运动。21世纪，平台经济、共享经济对传统管理理论形成挑战。

**现状与爆发**  
当前，{major}正经历数字化转型。数据驱动决策成为企业管理的新趋势。敏捷管理、OKR等新型管理方法被广泛采用。中国企业从"野蛮生长"走向精细化管理阶段。MBA教育市场竞争激烈，在职MBA、EMBA项目层出不穷。创业管理、家族企业传承等新方向受到关注。

**未来展望**  
数字化管理、ESG（环境、社会、治理）管理、创业创新管理将是{major}发展的新方向。中国经济转型升级需要大量管理人才。该领域就业面广，可在企业、政府部门、咨询公司等工作。管理岗位晋升需要时间和经验积累，但一旦成功，社会影响力和薪资水平都非常可观。""",
            "core_courses": ["管理学", "微观经济学", "宏观经济学", "市场营销", "财务管理", "人力资源管理", "战略管理", "组织行为学", "运营管理"],
            "related_majors": ["工商管理", "会计学", "经济学", "心理学"]
        },
        "计算机科学与技术": {
            "timeline": """**起源与发展**  
{major}的历史可追溯至19世纪。1837年英国数学家巴贝奇设计分析机，被认为是计算机的雏形。1936年，图灵提出"图灵机"模型，为计算机科学奠定理论基础。1946年，世界上第一台通用电子计算机ENIAC在美国诞生，重达30吨，使用了18000个电子管。

**挫折与争议**  
{major}发展历程中也经历过寒冬。1970年代，软件危机导致大型项目频繁失败，催生了结构化编程和软件工程。1980年代，日本第五代计算机计划失败，AI研究陷入低谷。计算机普及初期，"计算机导致失业"的担忧广泛存在。此外，网络安全、隐私保护、算法歧视等问题日益突出。

**重大突破**  
20世纪末至今，{major}迎来多次革命性突破。1990年代，万维网（WWW）发明，互联网进入寻常百姓家。2007年，iPhone发布，移动互联网时代开启。2012年，深度卷积神经网络在ImageNet竞赛中以压倒性优势获胜，深度学习时代到来。2017年，AlphaGo击败围棋世界冠军柯洁，AI能力惊艳世界。

**现状与爆发**  
当前，{major}正经历前所未有的爆发期。大语言模型（LLM）如ChatGPT、GPT-4的出现，标志着人工智能进入新纪元。云计算、大数据、物联网、5G等技术深度融合，催生了无数新业态。中国在5G通信、移动支付、电商等领域已领先全球。2023年全球AI市场规模突破5000亿美元，预计2030年将超万亿。

**未来展望**  
通用人工智能、量子计算、脑机接口、元宇宙将是{major}最具想象力的方向。该领域人才缺口巨大，特别是掌握AI、大模型、云计算等前沿技术的工程师，薪资水平在各行业中名列前茅。无论从社会价值还是个人发展来看，{major}都是当下的最优选择之一。""",
            "core_courses": ["计算机导论", "程序设计基础", "数据结构与算法", "计算机组成原理", "操作系统", "计算机网络", "数据库系统", "机器学习", "人工智能"],
            "related_majors": ["软件工程", "人工智能", "数据科学与大数据技术", "网络工程", "信息安全"]
        },
        "人工智能": {
            "timeline": """**起源与发展**  
1956年夏天，美国达特茅斯会议上，约翰·麦卡锡、马文·明斯基等科学家首次提出"人工智能"（Artificial Intelligence）概念，标志着AI作为一门学科的诞生。早期AI研究集中在符号主义和联结主义两条路线，图灵奖获得者纽厄尔和西蒙开发了"逻辑理论家"程序。

**挫折与争议**  
AI发展历程中经历了两次"寒冬"。1970年代，由于计算能力不足和资金枯竭，AI研究陷入低谷。1980年代，专家系统热潮消退，AI再次进入低谷。公众对AI的期待多次落空，"AI恐惧症"时有出现。此外，AI是否会导致大规模失业、算法偏见、深度伪造等问题引发广泛争议。

**重大突破**  
2012年是AI发展史上的转折点。深度卷积神经网络（CNN）在ImageNet竞赛中以85%的准确率夺冠，碾压传统方法。2016年，AlphaGo击败李世石，2017年击败柯洁，展示了深度强化学习的强大能力。2017年，Google提出Transformer架构，为大语言模型奠定基础。2022年11月，ChatGPT发布，AI进入生成式AI时代。

**现状与爆发**  
当前，AI正以前所未有的速度改变世界。GPT-4、Claude、Gemini等大模型展现出惊人的语言理解和生成能力。AI已渗透到各行各业：自动驾驶、智能客服、医疗诊断、金融风控等领域广泛应用。中国AI论文发表量、专利申请量均居全球第一，AI独角兽企业数量全球第二。AI市场规模从2018年的100亿增长到2023年的5000亿。

**未来展望**  
通用人工智能（AGI）、AI for Science、多模态AI是未来最有前景的方向。AI将重塑所有行业，AI+医疗、AI+教育、AI+制造等领域将涌现大量机会。预计到2030年，全球AI市场规模将突破10万亿美元。该领域人才严重短缺，特别是能够引领技术创新的顶尖人才，薪资水平无上限。对于有志于技术创新的人来说是最佳赛道。""",
            "core_courses": ["人工智能导论", "机器学习", "深度学习", "自然语言处理", "计算机视觉", "强化学习", "知识图谱", "AI伦理与治理"],
            "related_majors": ["计算机科学与技术", "数据科学与大数据技术", "数学", "统计学"]
        },
        "数据科学与大数据技术": {
            "timeline": """**起源与发展**  
{major}的萌芽可追溯至1960年代统计学与数据库技术的结合。1990年代，数据仓库和数据挖掘技术兴起，BI（商业智能）成为企业决策的重要工具。2008年，Nature杂志发表专题文章"Big Data"，"大数据"概念正式进入公众视野。2011年，麦肯锡发布报告《大数据：下一个创新、竞争和生产力的前沿》，引发全球关注。

**挫折与争议**  
{major}发展并非一帆风顺。早期数据分析工具能力有限，难以处理海量数据。数据质量问题（不完整、不准确、不一致）困扰着企业。隐私泄露事件频发，引发公众对数据安全的担忧。2020年，某些大数据公司因侵犯用户隐私被查处，行业经历洗牌。此外，"数据科学家"被炒作过度，实际人才需求与供给存在错位。

**重大突破**  
2010年代是{major}技术突破的黄金期。Hadoop、Spark等分布式计算框架的成熟，使处理PB级数据成为可能。云计算的普及降低了数据存储和计算成本。深度学习技术的突破使图像、语音、自然语言处理能力大幅提升。2017年，中国《数据安全法》《个人信息保护法》颁布，数据治理进入法治化时代。

**现状与爆发**  
当前，数据已成为新型生产要素。2023年中国数据产量超过12ZB（泽字节），位居全球第二。数据中台成为企业标配，数据驱动决策成为共识。涌现出字节跳动、阿里巴巴、腾讯等数据驱动型巨头。隐私计算、联邦学习等技术使"数据可用不可见"成为可能。数据要素市场建设加速，数据交易平台纷纷建立。

**未来展望**  
隐私计算、数据中台、AI+Data是未来三大方向。预计到2025年，中国大数据产业规模将突破3万亿元。该领域人才缺口巨大，特别是既懂业务又懂技术的复合型人才。薪资水平普遍较高，且随着经验积累增值空间大。选择{major}，就是选择站在数字经济时代的风口。""",
            "core_courses": ["概率论与数理统计", "Python程序设计", "数据库技术", "大数据技术", "机器学习", "数据可视化", "数据挖掘", "云计算"],
            "related_majors": ["计算机科学与技术", "人工智能", "统计学", "信息管理与信息系统"]
        },
        "金融学": {
            "timeline": """**起源与发展**  
{major}的历史可追溯至古代金融活动。古巴比伦的《汉谟拉比法典》已有关于利息的规定。意大利文艺复兴时期，美第奇银行开创了现代银行业务。1694年，英格兰银行成立，标志着中央银行制度的诞生。19世纪末20世纪初，股票市场、债券市场逐步规范化。1970年代，金融衍生品市场爆发式增长。

**挫折与争议**  
{major}发展历程中经历过多次金融危机。1929年华尔街股灾引发全球经济大萧条。1997年亚洲金融危机冲击新兴市场。2008年全球金融危机源于美国次贷泡沫，对实体经济造成严重冲击。此外，金融创新与监管的博弈、影子银行风险、加密货币监管等问题持续引发争议。

**重大突破**  
20世纪是{major}理论和技术双重突破的时期。1952年，马科维茨提出投资组合理论，开启了现代金融学的数学化时代。1970年代，布莱克-斯科尔斯期权定价模型的提出，奠定了金融工程的基础。1990年代，行为金融学挑战了"理性人"假设。金融科技（FinTech）革命正在重塑传统金融业态。

**现状与爆发**  
当前，{major}正经历数字化和全球化双重变革。中国已建成全球最大的银行体系和资本市场。移动支付用户规模全球第一，数字人民币试点稳步推进。科创板、北交所等资本市场改革为创新企业融资开辟新渠道。2023年中国金融业增加值占GDP比重约8%，仍是国民经济的支柱产业。

**未来展望**  
绿色金融、金融科技、财富管理将是{major}发展的三大方向。预计到2030年，中国金融业资产规模将突破500万亿元。该领域对高端人才需求旺盛，特别是在跨境金融、量化投资、金融风险管理等方向。薪资水平在各行业中名列前茅，但竞争也非常激烈。""",
            "core_courses": ["货币银行学", "国际金融", "证券投资学", "公司金融", "金融工程", "商业银行经营学", "金融风险管理"],
            "related_majors": ["经济学", "金融工程", "统计学", "会计学"]
        },
        "软件工程": {
            "timeline": """**起源与发展**  
{major}的历史可追溯至1940年代程序设计的诞生。1950年代，汇编语言和高级语言（如FORTRAN、COBOL）出现，软件开发成为独立职业。1968年，"软件危机"一词在NATO会议上被提出，引发行业对软件开发方法的反思。1970年代，结构化编程兴起；1980年代，面向对象编程成为主流。

**挫折与争议**  
{major}发展历程中经历过多次挫折。1960-1970年代，软件项目频繁延期、超预算、失败率高，"软件危机"严重困扰行业。1990年代，千年虫（Y2K）问题引发全球恐慌。软件专利与开源软件的争论持续多年。此外，软件行业的高强度工作模式、"35岁危机"等问题也引发社会关注。

**重大突破**  
2000年代是{major}方法论创新的高峰期。敏捷开发（Agile）理念的提出，彻底改变了软件开发流程。开源运动蓬勃发展，Linux、Apache、MySQL等开源软件改变行业格局。云计算的兴起使软件从产品转向服务（SaaS模式）。微服务架构、云原生等技术推动软件开发进入新纪元。

**现状与爆发**  
当前，{major}正经历前所未有的繁荣期。全球软件市场规模已突破5000亿美元。中国软件业收入从2010年的1.3万亿元增长到2023年的12万亿元。开源生态蓬勃发展，华为、阿里巴巴、腾讯等企业的开源项目影响力日增。低代码/无代码平台使软件开发门槛大幅降低。

**未来展望**  
云原生、DevOps、AI辅助编程将是{major}发展的三大方向。预计到2025年，中国软件业收入将突破15万亿元。该领域人才需求持续旺盛，但技术更新快，需要持续学习。薪资水平较高，但加班文化、竞争压力也不容忽视。选择{major}，需要做好终身学习的准备。""",
            "core_courses": ["程序设计基础", "数据结构与算法", "软件工程导论", "软件需求分析", "软件设计模式", "软件测试", "软件项目管理", "操作系统", "数据库系统"],
            "related_majors": ["计算机科学与技术", "人工智能", "网络工程", "信息安全"]
        },
        "口腔医学": {
            "timeline": """**起源与发展**  
{major}的历史可追溯至古代。古埃及和古印度已有牙科治疗的记载。1728年，法国牙医皮埃尔·福查德（Pierre Fauchard）出版《牙外科》一书，被尊为"现代牙科学之父"。19世纪，牙科逐渐从外科分离成为独立学科。20世纪初，牙科医学院在美国大量涌现。

**挫折与争议**  
{major}发展历程中面临诸多挑战。历史上，牙科治疗痛苦大，患者恐惧心理严重。19世纪的牙科麻醉技术不成熟，拔牙等操作给患者带来巨大痛苦。此外，牙科医疗服务长期以盈利为导向，公众可及性不足。口腔健康意识普及滞后，国民口腔健康状况堪忧。

**重大突破**  
20世纪是{major}技术飞跃的时期。1905年，X射线应用于牙科诊断；1920年代，牙科麻醉技术成熟，大大减轻患者痛苦。1950年代，龋齿预防（如氟化物应用）取得突破。1990年代，种植牙技术成熟，被誉为"人类的第三副牙齿"。近年来，数字化技术（CAD/CAM、3D打印）革新了牙科治疗。

**现状与爆发**  
当前，{major}正经历高速增长期。中国口腔医疗市场规模从2015年的约500亿元增长到2023年的约2000亿元。口腔医院、诊所数量激增，民营口腔医疗机构快速发展。口腔美容（正畸、美白、贴面）成为新增长点。儿童口腔健康意识提升，窝沟封闭等预防措施普及率提高。

**未来展望**  
数字化正畸、种植牙修复、口腔生物材料将是{major}最有前景的方向。预计到2030年，中国口腔医疗市场规模将突破5000亿元。该领域就业形势好，收入高，工作相对稳定。创业门槛相对较低，口腔诊所是医生创业的热门选择。""",
            "core_courses": ["口腔解剖生理学", "口腔组织病理学", "口腔材料学", "口腔颌面外科学", "口腔修复学", "口腔正畸学", "儿童口腔医学", "口腔预防医学"],
            "related_majors": ["临床医学", "医学影像学", "护理学"]
        },
        "工商管理": {
            "timeline": """**起源与发展**  
{major}的源头可追溯至19世纪末20世纪初的工业革命时期。1881年，美国沃顿商学院成立，标志着商科教育的开端。1911年，泰勒的《科学管理原理》出版，开创了管理学的科学时代。1920年代，亨利·法约尔的一般管理理论丰富了管理学体系。1940年代，行为科学学派兴起。

**挫折与争议**  
{major}发展历程中经历过多次反思。1960-1970年代，传统管理理论面临环境变化的挑战。日本企业的崛起（如丰田生产方式）对美国管理学形成冲击。2001年安然事件、2008年金融危机暴露了企业管理的失败，引发对MBA教育的反思。管理理论的普遍性与本土化之争持续存在。

**重大突破**  
20世纪是{major}理论创新的黄金期。1960年代，战略管理理论兴起，安索夫《公司战略》奠定基础。1980年代，迈克尔·波特竞争战略理论风靡全球。1990年代，彼得·圣吉《第五项修炼》推动学习型组织运动。21世纪，平台经济、共享经济对传统管理理论形成挑战。

**现状与爆发**  
当前，{major}正经历数字化转型。数据驱动决策成为企业管理的新趋势。敏捷管理、OKR等新型管理方法被广泛采用。中国企业从"野蛮生长"走向精细化管理阶段。MBA教育市场竞争激烈，在职MBA、EMBA项目层出不穷。创业管理、家族企业传承等新方向受到关注。

**未来展望**  
数字化管理、ESG（环境、社会、治理）管理、创业创新管理将是{major}发展的新方向。中国经济转型升级需要大量管理人才。该领域就业面广，可在企业、政府部门、咨询公司等工作。管理岗位晋升需要时间和经验积累，但一旦成功，社会影响力和薪资水平都非常可观。""",
            "core_courses": ["管理学", "微观经济学", "宏观经济学", "市场营销", "财务管理", "人力资源管理", "战略管理", "组织行为学", "运营管理"],
            "related_majors": ["经济学", "会计学", "金融学", "心理学"]
        },
        "会计学": {
            "timeline": """**起源与发展**  
{major}的历史可追溯至复式记账法的发明。1494年，意大利数学家卢卡·帕乔利（Luca Pacioli）在《算术、几何、比及比例概要》中系统阐述了复式记账法，被尊为"会计学之父"。19世纪末20世纪初，现代会计学逐渐形成。1900年代，注册会计师（CPA）制度在美国建立。

**挫折与争议**  
{major}发展历程中经历过多次危机。1929年华尔街股灾暴露了会计信息失真的危害。2001年安然事件、2002年世界通信公司丑闻，引发了对会计职业诚信的深刻反思。会计准则的国际趋同过程充满博弈。人工智能是否会取代会计师的讨论日益热烈。

**重大突破**  
20世纪是{major}理论和准则重大突破的时期。1930年代，美国会计准则体系逐步建立。1973年，国际会计准则理事会（IASB）成立，推动会计准则国际化。1990年代，盈余管理研究兴起。2008年金融危机后，公允价值会计准则受到重新审视。近年来，会计信息化、智能化取得长足进步。

**现状与爆发**  
当前，{major}正经历信息化和国际化双重变革。中国已与国际财务报告准则（IFRS）趋同。财务共享中心、财务机器人（RPA）广泛应用，大幅提升效率。管理会计受到重视，业财融合成为趋势。注册会计师考试通过率约10%，持证人数持续增长。

**未来展望**  
智能财务、业财融合、ESG报告将是{major}发展的三大方向。预计到2025年，中国会计服务市场规模将突破5000亿元。该领域人才需求稳定，但竞争激烈。注册会计师、管理会计师等高端证书是职业发展的重要砝码。工作相对稳定，是追求稳定的考生的理想选择。""",
            "core_courses": ["基础会计", "中级财务会计", "高级财务会计", "成本会计", "管理会计", "审计学", "财务管理", "会计信息系统", "税务会计"],
            "related_majors": ["财务管理", "审计学", "经济学", "金融学"]
        }
    }
    
    def __init__(self, cache_dir: str = "/tmp/doc_processor_cache"):
        self.cache_dir = cache_dir
        os.makedirs(cache_dir, exist_ok=True)
        self._load_cache()
    
    def _is_hot_major(self, major_name: str) -> bool:
        """判断是否为热门学科"""
        for hot_major in HOT_MAJORS:
            if hot_major in major_name or major_name in hot_major:
                return True
        return False
    
    def _get_cache_expiry_seconds(self, major_name: str) -> int:
        """根据学科热度获取缓存过期时间（秒）"""
        return CACHE_EXPIRY_CONFIG["hot"] if self._is_hot_major(major_name) else CACHE_EXPIRY_CONFIG["normal"]
    
    def _is_cache_expired(self, cache_entry: Dict) -> bool:
        """检查缓存是否过期"""
        if not cache_entry:
            return True
        
        expires_at = cache_entry.get("cache_expires_at")
        if not expires_at:
            return True
        
        try:
            expiry_time = datetime.fromisoformat(expires_at)
            return datetime.now() > expiry_time
        except:
            return True
    
    def _load_cache(self):
        """加载缓存"""
        self.cache = {}
        cache_file = os.path.join(self.cache_dir, "major_intro_cache.json")
        if os.path.exists(cache_file):
            try:
                with open(cache_file, 'r', encoding='utf-8') as f:
                    self.cache = json.load(f)
            except:
                self.cache = {}
    
    def _save_cache(self):
        """保存缓存"""
        cache_file = os.path.join(self.cache_dir, "major_intro_cache.json")
        try:
            with open(cache_file, 'w', encoding='utf-8') as f:
                json.dump(self.cache, f, ensure_ascii=False, indent=2)
        except:
            pass
    
    def _get_cache_key(self, major_name: str) -> str:
        """生成缓存键"""
        return hashlib.md5(major_name.encode('utf-8')).hexdigest()[:16]
    
    def _detect_category(self, major_name: str) -> str:
        """检测专业类别"""
        # 基于专业名称关键词判断类别
        category_keywords = {
            "工学": ["工程", "技术", "机械", "电子", "计算机", "软件", "通信", "自动化", "建筑", "土木", "材料", "化工"],
            "理学": ["数学", "物理", "化学", "生物", "统计", "科学"],
            "医学": ["医学", "临床", "口腔", "护理", "药学", "中医"],
            "法学": ["法学", "法律", "政治", "社会", "行政"],
            "经济学": ["经济", "金融", "管理", "会计", "贸易", "营销"],
            "文学": ["文学", "语言", "英语", "日语", "新闻", "传播", "广告"],
            "教育学": ["教育", "体育", "艺术", "音乐", "美术"],
            "农学": ["农学", "园林", "动物", "畜牧", "兽医"],
            "历史学": ["历史", "考古", "博物馆"],
            "管理学": ["管理", "工商", "会计", "财务", "人力资源", "营销", "商务"]
        }
        
        for category, keywords in category_keywords.items():
            for keyword in keywords:
                if keyword in major_name:
                    return category
        
        return "工学"
    
    def _get_major_timeline(self, major_name: str, detected_category: str) -> Dict[str, Any]:
        """获取专业时间线内容，优先匹配特定专业"""
        # 特定专业直接匹配
        special_majors = {
            "人工智能": "人工智能",
            "计算机科学与技术": "计算机科学与技术",
            "数据科学与大数据技术": "数据科学与大数据技术",
            "社会学": "社会学",
            "金融学": "金融学",
            "软件工程": "软件工程",
            "口腔医学": "口腔医学",
            "工商管理": "工商管理",
            "会计学": "会计学"
        }
        
        for key, template_key in special_majors.items():
            if key in major_name or major_name in key:
                if template_key in self.MAJOR_CATEGORIES:
                    return self.MAJOR_CATEGORIES[template_key]
        
        # 使用检测到的类别
        return self.MAJOR_CATEGORIES.get(detected_category, self.MAJOR_CATEGORIES["工学"])
    
    def generate_major_introduction(
        self,
        major_name: str,
        category: Optional[str] = None,
        related_majors: Optional[List[str]] = None
    ) -> Dict[str, Any]:
        """
        生成专业介绍
        
        Args:
            major_name: 专业名称
            category: 专业类别（可选，自动检测）
            related_majors: 相关专业列表（可选）
            
        Returns:
            Dict: 专业介绍内容
        """
        # 检测类别
        if not category:
            category = self._detect_category(major_name)
        
        # 检查缓存（带过期时间检测）
        cache_key = self._get_cache_key(major_name)
        if cache_key in self.cache:
            result = self.cache[cache_key]
            # 检查缓存是否过期
            if not self._is_cache_expired(result):
                result["cached"] = True
                result["cache_hit"] = True
                return result
            else:
                # 缓存已过期，删除旧缓存
                del self.cache[cache_key]
        
        # 获取专业时间线内容（优先匹配特定专业）
        category_config = self._get_major_timeline(major_name, category)
        
        # 使用时间线模板
        timeline = category_config.get("timeline", "")
        if timeline:
            # 解析时间线内容
            timeline_content = timeline.format(major=major_name, category=category, topic=major_name)
            # 整个时间线作为一篇完整的专业介绍
            introduction = timeline_content
        else:
            introduction = ""
        
        career_prospects = f"{major_name}专业毕业生就业前景广阔。随着行业快速发展，对专业人才需求旺盛。毕业生可在相关企业、事业单位、科研院所等从事研究、开发、管理等工作。薪资水平相对较高，职业发展空间大。建议在校期间多参加实践活动，提升专业技能，为未来职业发展打下坚实基础。"
        
        # 获取相关专业
        if not related_majors:
            related_majors = category_config["related_majors"]
        
        # 构建结果
        result = {
            "name": major_name,
            "category": category,
            "introduction": introduction,
            "core_courses": category_config.get("core_courses", []),
            "career_prospects": career_prospects,
            "related_majors": related_majors,
            "generated_at": datetime.now().isoformat(),
            "cached": False,
            "is_hot_major": self._is_hot_major(major_name)
        }
        
        # 计算缓存过期时间
        expiry_seconds = self._get_cache_expiry_seconds(major_name)
        expires_at = datetime.now() + timedelta(seconds=expiry_seconds)
        result["cache_expires_at"] = expires_at.isoformat()
        result["cache_ttl_hours"] = expiry_seconds // 3600
        
        # 保存缓存
        self.cache[cache_key] = result
        self._save_cache()
        
        return result
    
    def clear_cache(self, major_name: str = None):
        """清除缓存"""
        if major_name:
            cache_key = self._get_cache_key(major_name)
            if cache_key in self.cache:
                del self.cache[cache_key]
        else:
            self.cache = {}
        self._save_cache()


# 便捷函数
def get_major_introduction(major_name: str, category: str = None) -> Dict[str, Any]:
    """
    获取专业介绍
    
    Args:
        major_name: 专业名称
        category: 专业类别
        
    Returns:
        Dict: 专业介绍内容
    """
    processor = DocumentProcessor()
    return processor.generate_major_introduction(major_name, category)


if __name__ == "__main__":
    # 测试
    processor = DocumentProcessor()
    
    test_majors = [
        ("计算机科学与技术", "工学"),
        ("社会学", "法学"),
        ("临床医学", "医学"),
        ("金融学", "经济学")
    ]
    
    for major, category in test_majors:
        print(f"\n{'='*50}")
        print(f"专业: {major}")
        print(f"类别: {category}")
        
        result = processor.generate_major_introduction(major, category)
        print(f"\n溯源:\n{result['origin'][:100]}...")
        print(f"\n现状:\n{result['current_status'][:100]}...")
